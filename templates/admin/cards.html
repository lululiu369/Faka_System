{% extends "admin/base.html" %}

{% block title %}å¡å¯†ç®¡ç†{% endblock %}

{% block content %}
<div class="page-header">
    <h1>å¡å¯†ç®¡ç†</h1>
    <p>ç®¡ç†è´¦å·å¯†ç åº“å­˜</p>
</div>

<!-- æ·»åŠ å¡å¯† -->
<div class="card">
    <div class="card-header">
        <h2>æ‰¹é‡æ·»åŠ å¡å¯†</h2>
    </div>
    <div class="card-body">
        <form method="POST" action="{{ url_for('admin.add_cards') }}">
            <div class="form-group">
                <label>é€‰æ‹©åˆ†ç»„</label>
                <select name="group_id" class="form-control" required>
                    <option value="">-- è¯·é€‰æ‹©åˆ†ç»„ --</option>
                    {% for group in groups %}
                    <option value="{{ group.id }}" {{ 'selected' if current_group_id==group.id }}>
                        {{ group.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label>å¡å¯†ä¿¡æ¯ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                <textarea name="cards" class="form-control" rows="8" placeholder="æ¨èæ ¼å¼: è´¦å·----å¯†ç ----2FAå¯†é’¥
ä¾‹å¦‚: user@gmail.com----MyPass123----JBSWY3DPEHPK3PXP

å…¶ä»–æ ¼å¼:
è´¦å·----å¯†ç 
è´¦å·----å¯†ç ----å…¶ä»–ä¿¡æ¯
{&quot;account&quot;:&quot;xxx&quot;,&quot;password&quot;:&quot;xxx&quot;,&quot;totp_secret&quot;:&quot;xxx&quot;}"
                    required></textarea>
            </div>
            <div style="background: rgba(99, 102, 241, 0.1); border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                <strong style="color: var(--primary-light);">ğŸ’¡ 2FA å¯†é’¥è¯´æ˜</strong>
                <p style="color: var(--text-secondary); margin: 8px 0 0; font-size: 14px;">
                    2FAå¯†é’¥æ˜¯Google Authenticatorç­‰åº”ç”¨ä½¿ç”¨çš„Base32ç¼–ç å¯†é’¥ï¼ˆå¦‚ JBSWY3DPEHPK3PXPï¼‰ã€‚<br>
                    ç”¨æˆ·å…‘æ¢æ—¶ä¼šå®æ—¶æ˜¾ç¤º6ä½åŠ¨æ€éªŒè¯ç å’Œå€’è®¡æ—¶ã€‚
                </p>
            </div>
            <button type="submit" class="btn btn-primary">æ·»åŠ å¡å¯†</button>
        </form>
    </div>
</div>

<!-- ç­›é€‰ -->
<div class="card">
    <div class="card-header">
        <h2>å¡å¯†åˆ—è¡¨</h2>
    </div>
    <div class="card-body">
        <form class="filter-bar" method="GET">
            <select name="group_id" onchange="this.form.submit()">
                <option value="">å…¨éƒ¨åˆ†ç»„</option>
                {% for group in groups %}
                <option value="{{ group.id }}" {{ 'selected' if current_group_id==group.id }}>
                    {{ group.name }}
                </option>
                {% endfor %}
            </select>
            <select name="status" onchange="this.form.submit()">
                <option value="">å…¨éƒ¨çŠ¶æ€</option>
                <option value="available" {{ 'selected' if current_status=='available' }}>å¯ç”¨</option>
                <option value="assigned" {{ 'selected' if current_status=='assigned' }}>å·²åˆ†é…</option>
            </select>
        </form>

        {% if cards %}
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>è´¦å·</th>
                        <th>å¯†ç </th>
                        <th>2FAå¯†é’¥</th>
                        <th>åˆ†ç»„</th>
                        <th>çŠ¶æ€</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for card in cards %}
                    <tr>
                        <td>{{ card.id }}</td>
                        <td style="font-family: 'Roboto Mono', monospace;">
                            {{ card.account[:30] }}{% if card.account|length > 30 %}...{% endif %}
                        </td>
                        <td style="font-family: 'Roboto Mono', monospace;">
                            {{ card.password[:15] }}{% if card.password|length > 15 %}...{% endif %}
                        </td>
                        <td style="font-family: 'Roboto Mono', monospace; color: var(--primary-light);">
                            {% if card.totp_secret %}
                            {{ card.totp_secret[:10] }}...
                            {% else %}
                            <span style="color: var(--text-muted);">-</span>
                            {% endif %}
                        </td>
                        <td>{{ card.group.name if card.group else '-' }}</td>
                        <td>
                            {% if card.status == 'available' %}
                            <span class="badge badge-success">å¯ç”¨</span>
                            {% else %}
                            <span class="badge badge-warning">å·²åˆ†é…</span>
                            {% endif %}
                        </td>
                        <td>
                            <form method="POST" action="{{ url_for('admin.delete_card', card_id=card.id) }}"
                                style="display: inline;" onsubmit="return confirmDelete()">
                                <button type="submit" class="btn btn-secondary btn-sm"
                                    style="color: var(--danger);">åˆ é™¤</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p style="color: var(--text-muted); text-align: center; padding: 40px;">
            æš‚æ— å¡å¯†
        </p>
        {% endif %}
    </div>
</div>
{% endblock %}